<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goldilocks Atmosph√®re - √âquilibrez l'Atmosph√®re!</title>
    <style>
        :root {
            --habitable: #1E90FF;
            --too-hot: #FF4500;
            --too-cold: #ADD8E6;
            --runaway: #8B0000;
            --neutral: #f5f5f5;
            --text-color: #2c3e50;
        }
        /* ... (le reste du CSS reste identique √† la version pr√©c√©dente) ... */
        .feedback-loop {
            color: #e74c3c;
            font-weight: bold;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>Goldilocks Atmosph√®re</h1>
        <p>Ajuster les niveaux de gaz pour garder la Terre habitable !</p>

        <div class="earth-container">
            <div id="earth"></div>
        </div>
        <div id="temperature">Temp√©rature : 20¬∞C</div>

        <div class="score-container">
            <div>Score : <span id="score">0</span> secondes</div>
            <div>Temps √©coul√© : <span id="time">0</span> secondes</div>
            <div>Somme des gaz : <span id="total-gas">100</span>%</div>
        </div>

        <div class="slider-container">
            <div class="slider-label">
                <span>CO‚ÇÇ : <span id="co2-value">70</span>%</span>
            </div>
            <input type="range" id="co2" class="slider" min="0" max="97" value="70" step="1">
        </div>

        <div class="slider-container">
            <div class="slider-label">
                <span>N‚ÇÇ : <span id="n2-value">20</span>%</span>
            </div>
            <input type="range" id="n2" class="slider" min="0" max="97" value="20" step="1">
        </div>

        <div class="slider-container">
            <div class="slider-label">
                <span>H‚ÇÇO : <span id="h2o-value">10</span>%</span>
            </div>
            <input type="range" id="h2o" class="slider" min="0" max="20" value="10" step="1">
        </div>

        <div class="event-log" id="event-log"></div>

        <div class="instructions">
            <p>Objectif : Maintenir la temp√©rature entre 0¬∞C et 50¬∞C pendant au moins 30 secondes !</p>
            <button id="info-btn">Pourquoi ces gaz ?</button>
            <button id="reset-btn">R√©initialiser</button>
        </div>
    </div>

    <div class="modal" id="info-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-modal">&times;</span>
            <h2>M√©canismes Climatiques Avanc√©s</h2>
            <p><strong>CO‚ÇÇ (max 97%)</strong> : Gaz √† effet de serre. Sans CO‚ÇÇ, la Terre se refroidit. Avec trop de CO‚ÇÇ (>80%), un emballement peut se produire comme sur V√©nus (96% CO‚ÇÇ, 460¬∞C).</p>
            <p><strong>Boucles de r√©troaction</strong> :
            <ul>
                <li><strong>Emballement</strong> : Une temp√©rature √©lev√©e fait √©vaporer l'H‚ÇÇO ‚Üí plus de vapeur d'eau (gaz √† effet de serre) ‚Üí augmentation de temp√©rature.</li>
                <li><strong>Refroidissement</strong> : Une temp√©rature basse peut augmenter la condensation de l'H‚ÇÇO (pluies, neige) ‚Üí r√©duction de la vapeur d'eau.</li>
            </ul>
            </p>
            <p><strong>H‚ÇÇO</strong> : Vapeur d'eau = gaz √† effet de serre PUISSANT. Mais en exc√®s, elle peut aussi former des nuages r√©fl√©chissants (refroidissement).</p>
            <p><strong>N‚ÇÇ</strong> : Gaz inerte. Ne participe pas directement √† l'effet de serre.</p>
        </div>
    </div>

    <script>
        const co2Slider = document.getElementById('co2');
        const n2Slider = document.getElementById('n2');
        const h2oSlider = document.getElementById('h2o');
        const co2Value = document.getElementById('co2-value');
        const n2Value = document.getElementById('n2-value');
        const h2oValue = document.getElementById('h2o-value');
        const temperatureText = document.getElementById('temperature');
        const earth = document.getElementById('earth');
        const scoreText = document.getElementById('score');
        const timeText = document.getElementById('time');
        const totalGasText = document.getElementById('total-gas');
        const eventLog = document.getElementById('event-log');
        const infoBtn = document.getElementById('info-btn');
        const resetBtn = document.getElementById('reset-btn');
        const infoModal = document.getElementById('info-modal');
        const closeModal = document.getElementById('close-modal');

        let score = 0;
        let time = 0;
        let gameInterval;
        let eventInterval;
        let previousTemp = 20; // Pour les boucles de r√©troaction

        // √âv√©nements et interactions
        co2Slider.addEventListener('input', updateValues);
        n2Slider.addEventListener('input', updateValues);
        h2oSlider.addEventListener('input', updateValues);
        infoBtn.addEventListener('click', () => infoModal.style.display = 'flex');
        resetBtn.addEventListener('click', resetGame);
        closeModal.addEventListener('click', () => infoModal.style.display = 'none');
        window.addEventListener('click', (e) => { if (e.target === infoModal) infoModal.style.display = 'none'; });

        function updateValues() {
            // Mise √† jour des valeurs affich√©es
            co2Value.textContent = co2Slider.value;
            n2Value.textContent = n2Slider.value;
            h2oValue.textContent = h2oSlider.value;

            // Ajustement automatique de la somme des gaz
            let totalGas = parseInt(co2Slider.value) + parseInt(n2Slider.value) + parseInt(h2oSlider.value);
            totalGasText.textContent = totalGas;

            if (totalGas !== 100) {
                const ratio = 100 / totalGas;
                co2Slider.value = Math.min(97, Math.max(0, Math.floor(parseInt(co2Slider.value) * ratio)));
                n2Slider.value = Math.min(97, Math.max(0, Math.floor(parseInt(n2Slider.value) * ratio)));
                h2oSlider.value = Math.min(20, Math.max(0, Math.floor(parseInt(h2oSlider.value) * ratio)));

                addEventToLog(`‚ö†Ô∏è Ajustement automatique : somme des gaz pass√©e de ${totalGas}% √† 100%.`);
            }

            // Calcul de la temp√©rature AVEC boucles de r√©troaction
            const temperature = calculateTemperature();
            temperatureText.textContent = `Temp√©rature : ${temperature.toFixed(1)}¬∞C`;

            // Appliquer les boucles de r√©troaction
            applyFeedbackLoops(temperature);

            // Mise √† jour visuelle et score
            updateEarthColor(temperature);
            updateScore(temperature);
            previousTemp = temperature;
        }

        function calculateTemperature() {
            const co2 = parseInt(co2Slider.value);
            const h2o = parseInt(h2oSlider.value);

            if (co2 === 0) return -10; // Sans CO‚ÇÇ = froid

            // Emballement si CO‚ÇÇ > 80%
            if (co2 > 80) {
                const excessCO2 = co2 - 80;
                const baseTemp = 20 + (80 * 0.6) - (h2o * 0.3); // Temp√©rature de base avec CO‚ÇÇ=80%
                return baseTemp + (excessCO2 * 10); // Augmentation lin√©aire forte
            }
            // Calcul normal
            else {
                return 20 + (co2 * 0.6) - (h2o * 0.3);
            }
        }

        function applyFeedbackLoops(currentTemp) {
            // Boucle de r√©troaction positive (emballement)
            if (currentTemp > 50 && currentTemp > previousTemp) {
                const tempIncrease = currentTemp - previousTemp;
                const h2oIncrease = Math.min(2, tempIncrease * 0.2); // Augmentation de H‚ÇÇO due √† l'√©vaporation
                const newH2O = Math.min(20, parseInt(h2oSlider.value) + h2oIncrease);

                if (newH2O > parseInt(h2oSlider.value)) {
                    h2oSlider.value = newH2O;
                    h2oValue.textContent = newH2O;
                    addEventToLog(`üåä Boucle de r√©troaction : +${h2oIncrease}% H‚ÇÇO (√©vaporation due √† la chaleur).`, "feedback-loop");
                }
            }
            // Boucle de r√©troaction n√©gative (refroidissement)
            else if (currentTemp < 0 && currentTemp < previousTemp) {
                const tempDecrease = previousTemp - currentTemp;
                const h2oDecrease = Math.min(2, tempDecrease * 0.1); // R√©duction de H‚ÇÇO due √† la condensation
                const newH2O = Math.max(0, parseInt(h2oSlider.value) - h2oDecrease);

                if (newH2O < parseInt(h2oSlider.value)) {
                    h2oSlider.value = newH2O;
                    h2oValue.textContent = newH2O;
                    addEventToLog(`üåßÔ∏è Boucle de r√©troaction : -${h2oDecrease}% H‚ÇÇO (condensation due au froid).`, "feedback-loop");
                }
            }

            // Si emballement (T > 100¬∞C), augmentation automatique du CO‚ÇÇ
            if (currentTemp > 100) {
                const co2Increase = Math.min(5, (currentTemp - 100) * 0.1);
                const newCO2 = Math.min(97, parseInt(co2Slider.value) + co2Increase);

                if (newCO2 > parseInt(co2Slider.value)) {
                    co2Slider.value = newCO2;
                    co2Value.textContent = newCO2;
                    addEventToLog(`üî• Boucle de r√©troaction : +${co2Increase}% CO‚ÇÇ (lib√©ration due √† la chaleur extr√™me).`, "feedback-loop");
                }
            }
        }

        function updateEarthColor(temperature) {
            earth.classList.remove('hot', 'cold', 'critical-cold', 'runaway');

            if (temperature > 100) {
                earth.classList.add('runaway');
                addEventToLog("‚ö†Ô∏è EMBALLEMENT DE L'EFFET DE SERRE ! La temp√©rature d√©passe 100¬∞C.");
            }
            else if (temperature > 50) {
                earth.classList.add('hot');
            }
            else if (temperature < 0) {
                earth.classList.add('cold');
                if (parseInt(co2Slider.value) === 0) {
                    earth.classList.add('critical-cold');
                }
            }
        }

        function updateScore(temperature) {
            if (temperature >= 0 && temperature <= 50) {
                score++;
                scoreText.textContent = score;
            }
        }

        function generateRandomEvent() {
            const co2 = parseInt(co2Slider.value);
            const h2o = parseInt(h2oSlider.value);

            const events = [
                {
                    type: "volcano",
                    co2: Math.min(10, 97 - co2),
                    message: `üåã √âruption volcanique ! CO‚ÇÇ +${Math.min(10, 97 - co2)}%.`,
                    sound: "explosion"
                },
                {
                    type: "comet",
                    h2o: Math.min(5, 20 - h2o),
                    message: `‚òÑÔ∏è Pluie de com√®tes ! H‚ÇÇO +${Math.min(5, 20 - h2o)}%.`,
                    sound: "splash"
                },
                {
                    type: "algae",
                    co2: Math.max(-5, -co2),
                    message: `üåø Prolif√©ration d'algues ! CO‚ÇÇ ${Math.max(-5, -co2)}%.`,
                    sound: "nature"
                },
                {
                    type: "storm",
                    h2o: Math.min(3, 20 - h2o),
                    message: `üå™Ô∏è Temp√™te globale ! H‚ÇÇO +${Math.min(3, 20 - h2o)}%.`,
                    sound: "wind"
                }
            ];

            const possibleEvents = events.filter(event => {
                if (event.type === "volcano") return event.co2 > 0;
                if (event.type === "comet") return event.h2o > 0;
                if (event.type === "algae") return event.co2 < 0;
                if (event.type === "storm") return event.h2o > 0;
                return true;
            });

            if (possibleEvents.length === 0) return;

            const randomEvent = possibleEvents[Math.floor(Math.random() * possibleEvents.length)];
            addEventToLog(randomEvent.message);

            if (randomEvent.type === "volcano") {
                co2Slider.value = parseInt(co2Slider.value) + randomEvent.co2;
            } else if (randomEvent.type === "comet") {
                h2oSlider.value = parseInt(h2oSlider.value) + randomEvent.h2o;
            } else if (randomEvent.type === "algae") {
                co2Slider.value = Math.max(0, parseInt(co2Slider.value) + randomEvent.co2);
            } else if (randomEvent.type === "storm") {
                h2oSlider.value = parseInt(h2oSlider.value) + randomEvent.h2o;
            }

            updateValues();
        }

        function addEventToLog(message, type = "normal") {
            const eventElement = document.createElement('div');
            eventElement.className = `event ${type}`;
            eventElement.textContent = message;
            eventLog.appendChild(eventElement);
            eventLog.scrollTop = eventLog.scrollHeight;
        }

        function resetGame() {
            clearInterval(gameInterval);
            clearInterval(eventInterval);
            co2Slider.value = 70;
            n2Slider.value = 20;
            h2oSlider.value = 10;
            score = 0;
            time = 0;
            previousTemp = 20;
            scoreText.textContent = score;
            timeText.textContent = time;
            updateValues();
            startGame();
        }

        function startGame() {
            clearInterval(gameInterval);
            clearInterval(eventInterval);
            gameInterval = setInterval(() => {
                time++;
                timeText.textContent = time;
                if (time % 10 === 0) generateRandomEvent();
            }, 1000);
            eventInterval = setInterval(generateRandomEvent, 15000);
        }

        window.addEventListener('load', () => {
            updateValues();
            startGame();
        });
    </script>
</body>
</html>
